{"version":3,"sources":["useOptionsGetters.tsx"],"names":["React","NavigationStateContext","useOptionsGetters","key","getOptions","getState","optionsGettersFromChild","useRef","addOptionsGetter","parentAddOptionsGetter","useContext","getOptionsFromListener","useCallback","current","hasOwnProperty","result","getCurrentOptions","state","routes","index","optionsFromListener","undefined","useEffect","getter"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,sBAAP,MAAmC,0BAAnC;AAGA,eAAe,SAASC,iBAAT,CAA2B;AACxCC,EAAAA,GADwC;AAExCC,EAAAA,UAFwC;AAGxCC,EAAAA;AAHwC,CAA3B,EAQZ;AACD,QAAMC,uBAAuB,GAAGN,KAAK,CAACO,MAAN,CAE9B,EAF8B,CAAhC;AAIA,QAAM;AAAEC,IAAAA,gBAAgB,EAAEC;AAApB,MAA+CT,KAAK,CAACU,UAAN,CACnDT,sBADmD,CAArD;AAIA,QAAMU,sBAAsB,GAAGX,KAAK,CAACY,WAAN,CAAkB,MAAM;AACrD,SAAK,IAAIT,GAAT,IAAgBG,uBAAuB,CAACO,OAAxC,EAAiD;AAC/C,UAAIP,uBAAuB,CAACO,OAAxB,CAAgCC,cAAhC,CAA+CX,GAA/C,CAAJ,EAAyD;AAAA;;AACvD,cAAMY,MAAM,4BAAG,0BAAAT,uBAAuB,CAACO,OAAxB,EAAgCV,GAAhC,CAAH,0DAAG,kDAAf,CADuD,CAEvD;;AACA,YAAIY,MAAM,KAAK,IAAf,EAAqB;AACnB,iBAAOA,MAAP;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD,GAX8B,EAW5B,EAX4B,CAA/B;AAaA,QAAMC,iBAAiB,GAAGhB,KAAK,CAACY,WAAN,CAAkB,MAAM;AAAA;;AAChD,QAAIP,QAAJ,EAAc;AACZ,YAAMY,KAAK,GAAGZ,QAAQ,EAAtB;;AACA,UAAIY,KAAK,CAACC,MAAN,CAAaD,KAAK,CAACE,KAAnB,EAA0BhB,GAA1B,KAAkCA,GAAtC,EAA2C;AACzC;AACA,eAAO,IAAP;AACD;AACF;;AAED,UAAMiB,mBAAmB,GAAGT,sBAAsB,EAAlD;;AACA,QAAIS,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,aAAOA,mBAAP;AACD;;AACD,0BAAOhB,UAAP,aAAOA,UAAP,uBAAOA,UAAU,EAAjB,qDAAyBiB,SAAzB;AACD,GAdyB,EAcvB,CAAChB,QAAD,EAAWM,sBAAX,EAAmCP,UAAnC,EAA+CD,GAA/C,CAduB,CAA1B;AAgBAH,EAAAA,KAAK,CAACsB,SAAN,CAAgB,MAAM;AACpB,WAAOb,sBAAP,aAAOA,sBAAP,uBAAOA,sBAAsB,CAAGN,GAAH,EAASa,iBAAT,CAA7B;AACD,GAFD,EAEG,CAACA,iBAAD,EAAoBP,sBAApB,EAA4CN,GAA5C,CAFH;AAIA,QAAMK,gBAAgB,GAAGR,KAAK,CAACY,WAAN,CACvB,CAACT,GAAD,EAAcoB,MAAd,KAA0D;AACxDjB,IAAAA,uBAAuB,CAACO,OAAxB,CAAgCV,GAAhC,IAAuCoB,MAAvC;AAEA,WAAO,MAAM;AACXjB,MAAAA,uBAAuB,CAACO,OAAxB,CAAgCV,GAAhC,IAAuCkB,SAAvC;AACD,KAFD;AAGD,GAPsB,EAQvB,EARuB,CAAzB;AAWA,SAAO;AACLb,IAAAA,gBADK;AAELQ,IAAAA;AAFK,GAAP;AAID","sourcesContent":["import * as React from 'react';\nimport NavigationStateContext from './NavigationStateContext';\nimport { NavigationState } from '@react-navigation/routers';\n\nexport default function useOptionsGetters({\n  key,\n  getOptions,\n  getState,\n}: {\n  key?: string;\n  getOptions?: () => object | undefined;\n  getState?: () => NavigationState;\n}) {\n  const optionsGettersFromChild = React.useRef<\n    Record<string, (() => object | undefined | null) | undefined>\n  >({});\n\n  const { addOptionsGetter: parentAddOptionsGetter } = React.useContext(\n    NavigationStateContext\n  );\n\n  const getOptionsFromListener = React.useCallback(() => {\n    for (let key in optionsGettersFromChild.current) {\n      if (optionsGettersFromChild.current.hasOwnProperty(key)) {\n        const result = optionsGettersFromChild.current[key]?.();\n        // null means unfocused route\n        if (result !== null) {\n          return result;\n        }\n      }\n    }\n    return null;\n  }, []);\n\n  const getCurrentOptions = React.useCallback(() => {\n    if (getState) {\n      const state = getState();\n      if (state.routes[state.index].key !== key) {\n        // null means unfocused route\n        return null;\n      }\n    }\n\n    const optionsFromListener = getOptionsFromListener();\n    if (optionsFromListener !== null) {\n      return optionsFromListener;\n    }\n    return getOptions?.() ?? undefined;\n  }, [getState, getOptionsFromListener, getOptions, key]);\n\n  React.useEffect(() => {\n    return parentAddOptionsGetter?.(key!, getCurrentOptions);\n  }, [getCurrentOptions, parentAddOptionsGetter, key]);\n\n  const addOptionsGetter = React.useCallback(\n    (key: string, getter: () => object | undefined | null) => {\n      optionsGettersFromChild.current[key] = getter;\n\n      return () => {\n        optionsGettersFromChild.current[key] = undefined;\n      };\n    },\n    []\n  );\n\n  return {\n    addOptionsGetter,\n    getCurrentOptions,\n  };\n}\n"]}
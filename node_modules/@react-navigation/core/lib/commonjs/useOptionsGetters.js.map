{"version":3,"sources":["useOptionsGetters.tsx"],"names":["useOptionsGetters","key","getOptions","getState","optionsGettersFromChild","React","useRef","addOptionsGetter","parentAddOptionsGetter","useContext","NavigationStateContext","getOptionsFromListener","useCallback","current","hasOwnProperty","result","getCurrentOptions","state","routes","index","optionsFromListener","undefined","useEffect","getter"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;AAGe,SAASA,iBAAT,CAA2B;AACxCC,EAAAA,GADwC;AAExCC,EAAAA,UAFwC;AAGxCC,EAAAA;AAHwC,CAA3B,EAQZ;AACD,QAAMC,uBAAuB,GAAGC,KAAK,CAACC,MAAN,CAE9B,EAF8B,CAAhC;AAIA,QAAM;AAAEC,IAAAA,gBAAgB,EAAEC;AAApB,MAA+CH,KAAK,CAACI,UAAN,CACnDC,+BADmD,CAArD;AAIA,QAAMC,sBAAsB,GAAGN,KAAK,CAACO,WAAN,CAAkB,MAAM;AACrD,SAAK,IAAIX,GAAT,IAAgBG,uBAAuB,CAACS,OAAxC,EAAiD;AAC/C,UAAIT,uBAAuB,CAACS,OAAxB,CAAgCC,cAAhC,CAA+Cb,GAA/C,CAAJ,EAAyD;AAAA;;AACvD,cAAMc,MAAM,4BAAG,0BAAAX,uBAAuB,CAACS,OAAxB,EAAgCZ,GAAhC,CAAH,0DAAG,kDAAf,CADuD,CAEvD;;AACA,YAAIc,MAAM,KAAK,IAAf,EAAqB;AACnB,iBAAOA,MAAP;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD,GAX8B,EAW5B,EAX4B,CAA/B;AAaA,QAAMC,iBAAiB,GAAGX,KAAK,CAACO,WAAN,CAAkB,MAAM;AAAA;;AAChD,QAAIT,QAAJ,EAAc;AACZ,YAAMc,KAAK,GAAGd,QAAQ,EAAtB;;AACA,UAAIc,KAAK,CAACC,MAAN,CAAaD,KAAK,CAACE,KAAnB,EAA0BlB,GAA1B,KAAkCA,GAAtC,EAA2C;AACzC;AACA,eAAO,IAAP;AACD;AACF;;AAED,UAAMmB,mBAAmB,GAAGT,sBAAsB,EAAlD;;AACA,QAAIS,mBAAmB,KAAK,IAA5B,EAAkC;AAChC,aAAOA,mBAAP;AACD;;AACD,0BAAOlB,UAAP,aAAOA,UAAP,uBAAOA,UAAU,EAAjB,qDAAyBmB,SAAzB;AACD,GAdyB,EAcvB,CAAClB,QAAD,EAAWQ,sBAAX,EAAmCT,UAAnC,EAA+CD,GAA/C,CAduB,CAA1B;AAgBAI,EAAAA,KAAK,CAACiB,SAAN,CAAgB,MAAM;AACpB,WAAOd,sBAAP,aAAOA,sBAAP,uBAAOA,sBAAsB,CAAGP,GAAH,EAASe,iBAAT,CAA7B;AACD,GAFD,EAEG,CAACA,iBAAD,EAAoBR,sBAApB,EAA4CP,GAA5C,CAFH;AAIA,QAAMM,gBAAgB,GAAGF,KAAK,CAACO,WAAN,CACvB,CAACX,GAAD,EAAcsB,MAAd,KAA0D;AACxDnB,IAAAA,uBAAuB,CAACS,OAAxB,CAAgCZ,GAAhC,IAAuCsB,MAAvC;AAEA,WAAO,MAAM;AACXnB,MAAAA,uBAAuB,CAACS,OAAxB,CAAgCZ,GAAhC,IAAuCoB,SAAvC;AACD,KAFD;AAGD,GAPsB,EAQvB,EARuB,CAAzB;AAWA,SAAO;AACLd,IAAAA,gBADK;AAELS,IAAAA;AAFK,GAAP;AAID","sourcesContent":["import * as React from 'react';\nimport NavigationStateContext from './NavigationStateContext';\nimport { NavigationState } from '@react-navigation/routers';\n\nexport default function useOptionsGetters({\n  key,\n  getOptions,\n  getState,\n}: {\n  key?: string;\n  getOptions?: () => object | undefined;\n  getState?: () => NavigationState;\n}) {\n  const optionsGettersFromChild = React.useRef<\n    Record<string, (() => object | undefined | null) | undefined>\n  >({});\n\n  const { addOptionsGetter: parentAddOptionsGetter } = React.useContext(\n    NavigationStateContext\n  );\n\n  const getOptionsFromListener = React.useCallback(() => {\n    for (let key in optionsGettersFromChild.current) {\n      if (optionsGettersFromChild.current.hasOwnProperty(key)) {\n        const result = optionsGettersFromChild.current[key]?.();\n        // null means unfocused route\n        if (result !== null) {\n          return result;\n        }\n      }\n    }\n    return null;\n  }, []);\n\n  const getCurrentOptions = React.useCallback(() => {\n    if (getState) {\n      const state = getState();\n      if (state.routes[state.index].key !== key) {\n        // null means unfocused route\n        return null;\n      }\n    }\n\n    const optionsFromListener = getOptionsFromListener();\n    if (optionsFromListener !== null) {\n      return optionsFromListener;\n    }\n    return getOptions?.() ?? undefined;\n  }, [getState, getOptionsFromListener, getOptions, key]);\n\n  React.useEffect(() => {\n    return parentAddOptionsGetter?.(key!, getCurrentOptions);\n  }, [getCurrentOptions, parentAddOptionsGetter, key]);\n\n  const addOptionsGetter = React.useCallback(\n    (key: string, getter: () => object | undefined | null) => {\n      optionsGettersFromChild.current[key] = getter;\n\n      return () => {\n        optionsGettersFromChild.current[key] = undefined;\n      };\n    },\n    []\n  );\n\n  return {\n    addOptionsGetter,\n    getCurrentOptions,\n  };\n}\n"]}